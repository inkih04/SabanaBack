{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}My Issues App{% endblock %}</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'issues/styles.css' %}">
</head>
<body>
    <header class="header shadow">
        <div class="header__logo-container">
            <i class="material-icons">home</i>
            <h1 class="header__title">Sabana</h1>
        </div>
        <nav class="header__nav">
            <div class="header__nav-container">
                <a href="{% url 'issue_list' %}" class="header__nav-link">Go back to Issues</a>

                {% if request.user.profile.avatar %}
                    <img src="{{ request.user.profile.avatar.url }}" alt="avatar" class="header__avatar-img">
                {% else %}
                    <div class="header__avatar-img default-avatar">
                        <span class="material-icons">person</span>
                    </div>
                {% endif %}

                <span class="header__username">{{ request.user.username }}</span>
            </div>
        </nav>
    </header>


    <aside class="profile__sidebar">
        <div class="profile__content">
            <div class="profile__avatar-wrapper">
              <form class="avatar-form" method="post" action="{% url 'update_avatar' %}" enctype="multipart/form-data">
                {% csrf_token %}
                    <div class="profile__avatar-circle">
                        {% if request.user.profile.avatar %}
                            <img src="{{ request.user.profile.avatar.url }}" alt="avatar" class="profile__avatar-img">
                        {% else %}
                            <div>
                                <span class="material-icons">person</span>
                            </div>
                        {% endif %}
                    </div>
                <label for="avatar-upload-sidebar" class="avatar-edit-icon">
                  <span class="material-icons">edit</span>
                </label>
                <input id="avatar-upload-sidebar" type="file" name="avatar" onchange="this.form.submit()">
              </form>
            </div>
            <span class="profile__name">{{ request.user.username }}</span>
            <hr class="divider">
            <div class="profile__stadistics">
                <div class="profile__stadistics-item">
                    <span>0</span>
                    <span>Total Issues</span>
                </div>
                <div class="profile__stadistics-item">
                    <span>0</span>
                    <span>Total Issues</span>
                </div>
                <div class="profile__stadistics-item">
                    <span>0</span>
                    <span>Total Issues</span>
                </div>
            </div>
            <hr class="divider">
            <span class="profile__text">
                {% if request.user.profile.biography %}
                    {{ request.user.profile.biography }}
                {% else %}
                    Enter a bio for your profile
                {% endif %}
            </span>
            <a href="#modal-edit-bio" class="profile__btn-Edit open-modal">Edit Bio</a>
        </div>
    </aside>

<div class="content--profile">
    <div class="profile__changePage">
        <a href="{% url 'profile' %}?view=issues" class="pageChanger">Open Assigned Issues</a>
        <a href="{% url 'profile' %}?view=watched" class="pageChanger">Watched Issues</a>
        <a href="{% url 'profile' %}?view=comments" class="pageChanger">Comments</a>
    </div>

    <div class="issue-container">
        {% if view_mode == "comments" %}
            {# Aquí puedes incluir otro template, por ejemplo: #}
            {% include "issues/Comments.html" %}

        {% elif view_mode == "watched" %}
            {# Aquí incluir otro template o código para "Watched Issues" #}
            <p>Aquí se mostrarán los "Watched Issues".</p>
        {% else %}
            {# Valor por defecto, muestra la tabla de issues asignados #}
            {% include "issues/issue_table.html" %}
        {% endif %}
    </div>
</div>

    <div id="modal-edit-bio" class="profile__modal">
        <div class="profile__modal-content">
            <div class="profile__modal-header">
                <h1>Edit Bio</h1>
                <a href="#" class="profile__modal-close">&times;</a>
            </div>
            <form method="post" action="{% url 'update_bio' %}" class="profile__modal-form">
                {% csrf_token %}
                <label for="biography">Your biography</label>
                <textarea id="biography" name="biography" rows="6">{% if request.user.profile.biography %}{{ request.user.profile.biography }}{% else %}Enter a bio for your profile{% endif %}</textarea>
                <button type="submit">Save</button>
            </form>
        </div>
    </div>
</body>
</html>
